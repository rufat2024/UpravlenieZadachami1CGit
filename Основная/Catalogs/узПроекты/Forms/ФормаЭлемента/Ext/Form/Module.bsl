
#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)

	УстановитьПараметрыДляСписков();
	
	УстановитьВидимостьДоступность();
	
КонецПроцедуры

&НаСервере
Процедура ПослеЗаписиНаСервере(ТекущийОбъект, ПараметрыЗаписи)
	
	УстановитьПараметрыДляСписков();
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытийЭлементовШапкиФормы

&НаКлиенте
Процедура ОграничиватьСменуСтатусовПриИзменении(Элемент)
	
	УстановитьВидимостьДоступность();
	
КонецПроцедуры

#КонецОбласти 

#Область ОбработчикиСобытийСписокОграничиватьСменуСтатусов

&НаКлиенте
Процедура СписокОграничиватьСменуСтатусовПередНачаломДобавления(Элемент, Отказ, Копирование, Родитель, Группа, Параметр)
	
	Отказ = Истина; 
	
	Если Объект.Ссылка.Пустая() Тогда
		
		ТекстСообщения = НСтр("ru = 'Ошибка! необходимо записать проект перед настройкой доступности статусов '");
		ТекстСообщения = СтрШаблон(ТекстСообщения, );
		
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = ТекстСообщения;
		Сообщение.Сообщить();
		Отказ = Истина;   
		
		Возврат;
	КонецЕсли;
	
	ПараметрыФормы = Новый Структура();
	ПараметрыФормы.Вставить("Проект", Объект.Ссылка);

	СтрокаСписокОграничиватьСменуСтатусов = Элементы.СписокОграничиватьСменуСтатусов.ТекущиеДанные;	
	Если Копирование 
		И СтрокаСписокОграничиватьСменуСтатусов <> Неопределено тогда
		
		ПараметрыФормы.Вставить("ПользовательГруппа", СтрокаСписокОграничиватьСменуСтатусов.ПользовательГруппа);	
		ПараметрыФормы.Вставить("СтатусИсточник", СтрокаСписокОграничиватьСменуСтатусов.СтатусИсточник);	
		ПараметрыФормы.Вставить("СтатусПриемник", СтрокаСписокОграничиватьСменуСтатусов.СтатусПриемник);	
		
	КонецЕсли;	
		
	ОткрытьФорму("РегистрСведений.узДоступностьСменыСтатусовЗадач.Форма.ФормаЗаписи", ПараметрыФормы);	
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаСервере
Процедура УстановитьПараметрыДляСписков()
	
	ПроектОтбор = Неопределено;
	
	Если НЕ Объект.Ссылка.Пустая() Тогда 
		ПроектОтбор = Объект.Ссылка;	
	КонецЕсли;	
	
	СписокОсновныхЗадач.Параметры.УстановитьЗначениеПараметра("Проект", ПроектОтбор);
	СписокОграничиватьСменуСтатусов.Параметры.УстановитьЗначениеПараметра("Проект", ПроектОтбор);
	
КонецПроцедуры   

&НаСервере
Процедура УстановитьВидимостьДоступность()

	Элементы.СписокОграничиватьСменуСтатусов.Видимость = Объект.ОграничиватьСменуСтатусов;
	
КонецПроцедуры 

#КонецОбласти
